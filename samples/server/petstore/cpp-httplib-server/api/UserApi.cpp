/*
 * Generated by OpenAPI Generator, do not edit
 * https://openapi-generator.tech
 */

#include "UserApi.h"

namespace api {

void User::registerRoutes(httplib::Server& svr) {
    svr.Post("/user", [this](const httplib::Request& req, httplib::Response& res) {
                //request has schema in json, Hence parsing the request body to the model
                models::User request = models::User::fromJson(nlohmann::json::parse(req.body));
                handlePostForUser(request);
    });

    svr.Post("/user/createWithArray", [this](const httplib::Request& req, httplib::Response& res) {
                //request has schema in json, Hence parsing the request body to the model
                models::User request = models::User::fromJson(nlohmann::json::parse(req.body));
                handlePostForUserCreateWithArray(request);
    });

    svr.Post("/user/createWithList", [this](const httplib::Request& req, httplib::Response& res) {
                //request has schema in json, Hence parsing the request body to the model
                models::User request = models::User::fromJson(nlohmann::json::parse(req.body));
                handlePostForUserCreateWithList(request);
    });

    svr.Delete("/user/{username}", [this](const httplib::Request& req, httplib::Response& res) {
                handleDeleteForUser{username}();
    });

    svr.Get("/user/{username}", [this](const httplib::Request& req, httplib::Response& res) {
        try {
                auto result = handleGetForUser{username}();

                std::visit([&](const auto& value) {
                            using T = std::decay_t<decltype(value)>;
                            if constexpr (std::is_same_v<T, models::User>) {
                                res.status = 200;
                                res.set_content(value.toJson(value).dump(), "application/json");
                            }
                        },
                        static_cast<const decltype(result)&>(result));
        } catch (const nlohmann::json::parse_error& e)
        {
            res.status = 400;
            nlohmann::json errorJson = {
                {"message", "Invalid JSON: " + std::string(e.what())}
            };
            res.set_content(errorJson.dump(), "application/json");
        } catch (const std::exception& e)
        {
            res.status = 500;
            nlohmann::json errorJson = {
                {"message", "Internal Server Error: " + std::string(e.what())}
            };
            res.set_content(errorJson.dump(), "application/json");
        }
    });

    svr.Get("/user/login", [this](const httplib::Request& req, httplib::Response& res) {
        try {
                auto result = handleGetForUserLogin();

                std::visit([&](const auto& value) {
                            using T = std::decay_t<decltype(value)>;
                            if constexpr (std::is_same_v<T, std::string>) {
                                res.status = 200;
                                res.set_content(value.toJson(value).dump(), "application/json");
                            }
                        },
                        static_cast<const decltype(result)&>(result));
        } catch (const nlohmann::json::parse_error& e)
        {
            res.status = 400;
            nlohmann::json errorJson = {
                {"message", "Invalid JSON: " + std::string(e.what())}
            };
            res.set_content(errorJson.dump(), "application/json");
        } catch (const std::exception& e)
        {
            res.status = 500;
            nlohmann::json errorJson = {
                {"message", "Internal Server Error: " + std::string(e.what())}
            };
            res.set_content(errorJson.dump(), "application/json");
        }
    });

    svr.Get("/user/logout", [this](const httplib::Request& req, httplib::Response& res) {
                handleGetForUserLogout();
    });

    svr.Put("/user/{username}", [this](const httplib::Request& req, httplib::Response& res) {
                //request has schema in json, Hence parsing the request body to the model
                models::User request = models::User::fromJson(nlohmann::json::parse(req.body));
                handlePutForUser{username}(request);
    });

}

} // namespace api